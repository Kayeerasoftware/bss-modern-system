<!-- ADD THIS AFTER LINE 3043 (after the </thead> tag in Fundraising Management section) -->

<tbody class="bg-white">
    <template x-for="(fundraising, index) in fundraisings" :key="fundraising.id">
        <tr class="group relative border-b-4" :class="index % 2 === 0 ? 'bg-white border-rose-200' : 'bg-gradient-to-r from-rose-50 to-pink-50 border-pink-200'">
            <td class="py-4 px-4 border-r border-gray-200">
                <span class="font-mono text-sm font-semibold text-rose-600" x-text="fundraising.campaign_id"></span>
            </td>
            <td class="py-4 px-4 border-r border-gray-200">
                <span class="font-semibold text-gray-800" x-text="fundraising.title"></span>
            </td>
            <td class="py-4 px-4 border-r border-gray-200">
                <span class="font-semibold text-green-600" x-text="formatCurrency(fundraising.target_amount)"></span>
            </td>
            <td class="py-4 px-4 border-r border-gray-200">
                <span class="font-semibold text-blue-600" x-text="formatCurrency(fundraising.raised_amount)"></span>
            </td>
            <td class="py-4 px-4 border-r border-gray-200">
                <div class="flex items-center gap-2">
                    <div class="w-20 bg-gray-200 rounded-full h-2">
                        <div class="h-2 rounded-full bg-gradient-to-r from-rose-500 to-pink-500 transition-all" :style="`width: ${Math.min((fundraising.raised_amount / fundraising.target_amount) * 100, 100)}%`"></div>
                    </div>
                    <span class="text-xs font-semibold" x-text="Math.round((fundraising.raised_amount / fundraising.target_amount) * 100) + '%'"></span>
                </div>
            </td>
            <td class="py-4 px-4 border-r border-gray-200">
                <span class="px-3 py-1.5 rounded-full text-xs font-semibold" :class="{
                    'bg-green-100 text-green-800': fundraising.status === 'active',
                    'bg-blue-100 text-blue-800': fundraising.status === 'completed',
                    'bg-gray-100 text-gray-800': fundraising.status === 'cancelled'
                }" x-text="fundraising.status"></span>
            </td>
            <td class="py-4 px-4">
                <div class="flex gap-2">
                    <button @click="editFundraising(fundraising)" class="p-2 bg-blue-100 text-blue-600 rounded-lg hover:bg-blue-200 hover:scale-110 transition-all duration-200" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button @click="deleteFundraising(fundraising.id)" class="p-2 bg-red-100 text-red-600 rounded-lg hover:bg-red-200 hover:scale-110 transition-all duration-200" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        </tr>
    </template>
</tbody>
</table>
</div>
</div>

<!-- ADD FUNDRAISING MODALS BEFORE THE CLOSING </body> TAG -->

<!-- Add Fundraising Modal -->
<div x-show="showAddFundraisingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showAddFundraisingModal = false">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto" @click.stop>
        <h3 class="text-2xl font-bold mb-4 text-rose-600">
            <i class="fas fa-hand-holding-heart mr-2"></i>New Fundraising Campaign
        </h3>
        <form @submit.prevent="saveFundraising()">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Campaign Title</label>
                    <input type="text" x-model="fundraisingForm.title" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description</label>
                    <textarea x-model="fundraisingForm.description" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" rows="3" required></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Target Amount (UGX)</label>
                        <input type="number" x-model="fundraisingForm.target_amount" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Raised Amount (UGX)</label>
                        <input type="number" x-model="fundraisingForm.raised_amount" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" min="0" value="0">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Start Date</label>
                        <input type="date" x-model="fundraisingForm.start_date" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">End Date</label>
                        <input type="date" x-model="fundraisingForm.end_date" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Status</label>
                    <select x-model="fundraisingForm.status" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-6">
                <button type="button" @click="showAddFundraisingModal = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700">
                    <i class="fas fa-save mr-2"></i>Save Campaign
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Edit Fundraising Modal -->
<div x-show="showEditFundraisingModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" @click.self="showEditFundraisingModal = false">
    <div class="bg-white rounded-xl p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto" @click.stop>
        <h3 class="text-2xl font-bold mb-4 text-rose-600">
            <i class="fas fa-edit mr-2"></i>Edit Fundraising Campaign
        </h3>
        <form @submit.prevent="updateFundraising()">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-medium mb-1">Campaign Title</label>
                    <input type="text" x-model="editingFundraising.title" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Description</label>
                    <textarea x-model="editingFundraising.description" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" rows="3" required></textarea>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Target Amount (UGX)</label>
                        <input type="number" x-model="editingFundraising.target_amount" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">Raised Amount (UGX)</label>
                        <input type="number" x-model="editingFundraising.raised_amount" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" min="0">
                    </div>
                </div>
                <div class="grid grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-medium mb-1">Start Date</label>
                        <input type="date" x-model="editingFundraising.start_date" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium mb-1">End Date</label>
                        <input type="date" x-model="editingFundraising.end_date" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-medium mb-1">Status</label>
                    <select x-model="editingFundraising.status" class="w-full p-3 border rounded-lg focus:ring-2 focus:ring-rose-500">
                        <option value="active">Active</option>
                        <option value="completed">Completed</option>
                        <option value="cancelled">Cancelled</option>
                    </select>
                </div>
            </div>
            <div class="flex justify-end gap-2 mt-6">
                <button type="button" @click="showEditFundraisingModal = false" class="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                <button type="submit" class="px-4 py-2 bg-rose-600 text-white rounded-lg hover:bg-rose-700">
                    <i class="fas fa-save mr-2"></i>Update Campaign
                </button>
            </div>
        </form>
    </div>
</div>

<!-- ADD THESE JAVASCRIPT FUNCTIONS TO THE adminPanel() FUNCTION IN main2.js -->
/*
fundraisings: [],
fundraisingForm: { title: '', description: '', target_amount: '', raised_amount: 0, start_date: '', end_date: '', status: 'active' },
editingFundraising: null,
showAddFundraisingModal: false,
showEditFundraisingModal: false,

async loadFundraisings() {
    try {
        const response = await fetch('/api/fundraisings');
        this.fundraisings = await response.json();
    } catch (error) {
        console.error('Error loading fundraisings:', error);
    }
},

async saveFundraising() {
    try {
        const response = await fetch('/api/fundraisings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(this.fundraisingForm)
        });
        const data = await response.json();
        if (data.success) {
            this.fundraisings.unshift(data.fundraising);
            this.showAddFundraisingModal = false;
            this.fundraisingForm = { title: '', description: '', target_amount: '', raised_amount: 0, start_date: '', end_date: '', status: 'active' };
            alert('Campaign created successfully!');
        }
    } catch (error) {
        console.error('Error saving fundraising:', error);
        alert('Error creating campaign');
    }
},

editFundraising(fundraising) {
    this.editingFundraising = { ...fundraising };
    this.showEditFundraisingModal = true;
},

async updateFundraising() {
    try {
        const response = await fetch(`/api/fundraisings/${this.editingFundraising.id}`, {
            method: 'PUT',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(this.editingFundraising)
        });
        const data = await response.json();
        if (data.success) {
            const index = this.fundraisings.findIndex(f => f.id === this.editingFundraising.id);
            if (index !== -1) this.fundraisings[index] = data.fundraising;
            this.showEditFundraisingModal = false;
            alert('Campaign updated successfully!');
        }
    } catch (error) {
        console.error('Error updating fundraising:', error);
        alert('Error updating campaign');
    }
},

async deleteFundraising(id) {
    if (!confirm('Are you sure you want to delete this campaign?')) return;
    try {
        const response = await fetch(`/api/fundraisings/${id}`, { method: 'DELETE' });
        const data = await response.json();
        if (data.success) {
            this.fundraisings = this.fundraisings.filter(f => f.id !== id);
            alert('Campaign deleted successfully!');
        }
    } catch (error) {
        console.error('Error deleting fundraising:', error);
        alert('Error deleting campaign');
    }
}
*/
