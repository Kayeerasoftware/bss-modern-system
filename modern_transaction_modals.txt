<!-- Withdrawal Modal -->
<div x-show="showWithdrawalModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-2 sm:p-4" @click.self="showWithdrawalModal = false">
    <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[95vh] flex flex-col shadow-2xl">
        <div class="sticky top-0 bg-gradient-to-r from-red-600 to-rose-600 text-white px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-arrow-up"></i>Record Withdrawal
                </h3>
                <button @click="showWithdrawalModal = false; resetWithdrawalForm()" class="text-white hover:bg-white/20 p-2 rounded-full transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <form @submit.prevent="recordWithdrawal()" class="flex-1 overflow-y-auto p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-gray-400 mr-1"></i>Member *
                    </label>
                    <input type="text" x-model="withdrawalMemberSearch" @input="filterWithdrawalMembers()" @focus="showWithdrawalDropdown = true" placeholder="Search member..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition">
                    <div x-show="showWithdrawalDropdown" class="relative">
                        <div class="absolute z-20 w-full max-h-48 overflow-y-auto bg-white border-2 border-red-200 rounded-xl shadow-xl mt-2">
                            <template x-for="member in filteredWithdrawalMembers" :key="member.member_id">
                                <div @click="selectWithdrawalMember(member)" class="p-3 hover:bg-red-50 cursor-pointer border-b last:border-b-0 transition">
                                    <div class="font-semibold text-sm" x-text="member.member_id + ' - ' + member.full_name"></div>
                                    <div class="text-xs text-gray-600">Balance: <span class="font-semibold text-red-600" x-text="formatCurrency(member.savings)"></span></div>
                                </div>
                            </template>
                        </div>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-money-bill-wave text-gray-400 mr-1"></i>Amount (UGX) *
                        </label>
                        <input type="number" x-model="withdrawalForm.amount" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-wallet text-gray-400 mr-1"></i>Withdrawal Method *
                        </label>
                        <select x-model="withdrawalForm.method" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition bg-white" required>
                            <option value="cash">üíµ Cash</option>
                            <option value="bank_transfer">üè¶ Bank Transfer</option>
                            <option value="mobile_money">üì± Mobile Money</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-gray-400 mr-1"></i>Purpose / Reason *
                    </label>
                    <textarea x-model="withdrawalForm.description" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-red-500 focus:border-red-500 transition resize-y" rows="2" placeholder="Enter withdrawal purpose" required></textarea>
                </div>
                <div class="p-4 bg-gradient-to-br from-red-50 to-rose-50 rounded-xl border-2 border-red-200">
                    <h4 class="font-bold text-gray-800 mb-3 flex items-center gap-2">
                        <i class="fas fa-receipt text-red-600"></i>Withdrawal Summary
                    </h4>
                    <div class="space-y-2 text-sm">
                        <div class="flex justify-between">
                            <span class="text-gray-600">Withdrawal Amount:</span>
                            <span class="font-bold text-red-600 text-lg" x-text="formatCurrency(withdrawalForm.amount || 0)"></span>
                        </div>
                        <div class="flex justify-between">
                            <span class="text-gray-600">Current Balance:</span>
                            <span class="font-semibold text-gray-800" x-text="formatCurrency(withdrawalMemberBalance)"></span>
                        </div>
                        <div class="flex justify-between border-t-2 border-red-300 pt-2 mt-2">
                            <span class="font-bold text-gray-800">New Balance:</span>
                            <span class="font-bold text-green-600 text-xl" x-text="formatCurrency(withdrawalMemberBalance - (parseFloat(withdrawalForm.amount) || 0))"></span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t-2 border-gray-200 mt-6">
                <button type="button" @click="showWithdrawalModal = false; resetWithdrawalForm()" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button type="submit" class="flex-1 px-8 py-3 bg-gradient-to-r from-red-600 to-rose-600 text-white rounded-xl hover:from-red-700 hover:to-rose-700 transition font-semibold shadow-lg hover:shadow-xl">
                    <i class="fas fa-check-circle mr-2"></i>Record Withdrawal
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Loan Payment Modal -->
<div x-show="showLoanPaymentModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-2 sm:p-4" @click.self="showLoanPaymentModal = false">
    <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[95vh] flex flex-col shadow-2xl">
        <div class="sticky top-0 bg-gradient-to-r from-purple-600 to-violet-600 text-white px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-hand-holding-usd"></i>Record Loan Payment
                </h3>
                <button @click="showLoanPaymentModal = false" class="text-white hover:bg-white/20 p-2 rounded-full transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <form @submit.prevent="recordLoanPayment()" class="flex-1 overflow-y-auto p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-gray-400 mr-1"></i>Member *
                    </label>
                    <input type="text" placeholder="Search member..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-money-bill-wave text-gray-400 mr-1"></i>Payment Amount (UGX) *
                        </label>
                        <input type="number" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-wallet text-gray-400 mr-1"></i>Payment Method *
                        </label>
                        <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition bg-white" required>
                            <option value="cash">üíµ Cash</option>
                            <option value="bank_transfer">üè¶ Bank Transfer</option>
                            <option value="mobile_money">üì± Mobile Money</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-gray-400 mr-1"></i>Notes
                    </label>
                    <textarea class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-purple-500 focus:border-purple-500 transition resize-y" rows="2" placeholder="Payment notes"></textarea>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t-2 border-gray-200 mt-6">
                <button type="button" @click="showLoanPaymentModal = false" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button type="submit" class="flex-1 px-8 py-3 bg-gradient-to-r from-purple-600 to-violet-600 text-white rounded-xl hover:from-purple-700 hover:to-violet-700 transition font-semibold shadow-lg hover:shadow-xl">
                    <i class="fas fa-check-circle mr-2"></i>Record Payment
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Loan Request Modal -->
<div x-show="showLoanRequestModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-2 sm:p-4" @click.self="showLoanRequestModal = false">
    <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[95vh] flex flex-col shadow-2xl">
        <div class="sticky top-0 bg-gradient-to-r from-indigo-600 to-blue-600 text-white px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-file-invoice-dollar"></i>New Loan Request
                </h3>
                <button @click="showLoanRequestModal = false" class="text-white hover:bg-white/20 p-2 rounded-full transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <form @submit.prevent="submitLoanRequest()" class="flex-1 overflow-y-auto p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-gray-400 mr-1"></i>Member *
                    </label>
                    <input type="text" placeholder="Search member..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-money-bill-wave text-gray-400 mr-1"></i>Loan Amount (UGX) *
                        </label>
                        <input type="number" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition" min="10000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-calendar text-gray-400 mr-1"></i>Repayment Period *
                        </label>
                        <select class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition bg-white" required>
                            <option value="3">3 Months</option>
                            <option value="6">6 Months</option>
                            <option value="12">12 Months</option>
                        </select>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-gray-400 mr-1"></i>Purpose *
                    </label>
                    <textarea class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-indigo-500 focus:border-indigo-500 transition resize-y" rows="2" placeholder="Loan purpose" required></textarea>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t-2 border-gray-200 mt-6">
                <button type="button" @click="showLoanRequestModal = false" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button type="submit" class="flex-1 px-8 py-3 bg-gradient-to-r from-indigo-600 to-blue-600 text-white rounded-xl hover:from-indigo-700 hover:to-blue-700 transition font-semibold shadow-lg hover:shadow-xl">
                    <i class="fas fa-check-circle mr-2"></i>Submit Request
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Fundraising Modal -->
<div x-show="showFundraisingModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-2 sm:p-4" @click.self="showFundraisingModal = false">
    <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[95vh] flex flex-col shadow-2xl">
        <div class="sticky top-0 bg-gradient-to-r from-pink-600 to-rose-600 text-white px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-hand-holding-heart"></i>Record Fundraising
                </h3>
                <button @click="showFundraisingModal = false" class="text-white hover:bg-white/20 p-2 rounded-full transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <form @submit.prevent="recordFundraising()" class="flex-1 overflow-y-auto p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-gray-400 mr-1"></i>Member *
                    </label>
                    <input type="text" placeholder="Search member..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-money-bill-wave text-gray-400 mr-1"></i>Amount (UGX) *
                        </label>
                        <input type="number" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-tag text-gray-400 mr-1"></i>Campaign Name *
                        </label>
                        <input type="text" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition" placeholder="Campaign name" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-gray-400 mr-1"></i>Purpose *
                    </label>
                    <textarea class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-pink-500 focus:border-pink-500 transition resize-y" rows="2" placeholder="Fundraising purpose" required></textarea>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t-2 border-gray-200 mt-6">
                <button type="button" @click="showFundraisingModal = false" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button type="submit" class="flex-1 px-8 py-3 bg-gradient-to-r from-pink-600 to-rose-600 text-white rounded-xl hover:from-pink-700 hover:to-rose-700 transition font-semibold shadow-lg hover:shadow-xl">
                    <i class="fas fa-check-circle mr-2"></i>Record Fundraising
                </button>
            </div>
        </form>
    </div>
</div>

<!-- Condolence Modal -->
<div x-show="showCondolenceModal" class="fixed inset-0 bg-black bg-opacity-60 flex items-center justify-center z-50 p-2 sm:p-4" @click.self="showCondolenceModal = false">
    <div class="bg-white rounded-2xl w-full max-w-2xl max-h-[95vh] flex flex-col shadow-2xl">
        <div class="sticky top-0 bg-gradient-to-r from-gray-600 to-slate-600 text-white px-6 py-4 rounded-t-2xl z-10">
            <div class="flex justify-between items-center">
                <h3 class="text-xl font-bold flex items-center gap-2">
                    <i class="fas fa-dove"></i>Record Condolence
                </h3>
                <button @click="showCondolenceModal = false" class="text-white hover:bg-white/20 p-2 rounded-full transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>
        </div>
        <form @submit.prevent="recordCondolence()" class="flex-1 overflow-y-auto p-6">
            <div class="space-y-4">
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-user text-gray-400 mr-1"></i>Member *
                    </label>
                    <input type="text" placeholder="Search member..." class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition">
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-money-bill-wave text-gray-400 mr-1"></i>Support Amount (UGX) *
                        </label>
                        <input type="number" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition" min="1000" required>
                    </div>
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            <i class="fas fa-user-friends text-gray-400 mr-1"></i>Deceased Name *
                        </label>
                        <input type="text" class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition" placeholder="Name" required>
                    </div>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                        <i class="fas fa-align-left text-gray-400 mr-1"></i>Message
                    </label>
                    <textarea class="w-full px-4 py-3 border-2 border-gray-300 rounded-xl focus:ring-2 focus:ring-gray-500 focus:border-gray-500 transition resize-y" rows="2" placeholder="Condolence message"></textarea>
                </div>
            </div>
            <div class="flex flex-col sm:flex-row gap-3 pt-4 border-t-2 border-gray-200 mt-6">
                <button type="button" @click="showCondolenceModal = false" class="flex-1 px-6 py-3 bg-gray-100 text-gray-700 rounded-xl hover:bg-gray-200 transition font-semibold">
                    <i class="fas fa-times mr-2"></i>Cancel
                </button>
                <button type="submit" class="flex-1 px-8 py-3 bg-gradient-to-r from-gray-600 to-slate-600 text-white rounded-xl hover:from-gray-700 hover:to-slate-700 transition font-semibold shadow-lg hover:shadow-xl">
                    <i class="fas fa-check-circle mr-2"></i>Record Condolence
                </button>
            </div>
        </form>
    </div>
</div>
