@extends('layouts.admin')\n\n@section('content')\n<div class=\"min-h-screen bg-gradient-to-br from-blue-50 via-purple-50 to-pink-50 p-3 md:p-6\">\n    <!-- Header -->\n    <div class=\"flex items-center gap-3 mb-6\">\n        <a href=\"{{ route('admin.members.index') }}\" class=\"p-3 bg-white rounded-xl shadow-lg hover:shadow-xl transition-all transform hover:scale-105\">\n            <i class=\"fas fa-arrow-left text-blue-600\"></i>\n        </a>\n        <div>\n            <h2 class=\"text-2xl md:text-3xl font-bold bg-gradient-to-r from-blue-600 via-purple-600 to-pink-600 bg-clip-text text-transparent\">Bulk Picture Upload</h2>\n            <p class=\"text-gray-600 text-sm\">Upload profile pictures for multiple members at once</p>\n        </div>\n    </div>\n\n    <div class=\"max-w-6xl mx-auto space-y-6\">\n        <!-- Statistics Card -->\n        <div class=\"bg-white rounded-3xl shadow-2xl p-6 border border-gray-100\">\n            <div class=\"flex items-center gap-3 mb-4\">\n                <div class=\"bg-gradient-to-r from-green-600 to-teal-600 p-3 rounded-xl shadow-lg\">\n                    <i class=\"fas fa-chart-pie text-white text-lg\"></i>\n                </div>\n                <h3 class=\"text-xl font-bold text-gray-800\">Picture Statistics</h3>\n            </div>\n            \n            <div id=\"picture-stats\" class=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n                <div class=\"bg-gradient-to-r from-blue-50 to-blue-100 p-4 rounded-xl\">\n                    <div class=\"text-2xl font-bold text-blue-600\" id=\"total-members\">-</div>\n                    <div class=\"text-sm text-blue-700\">Total Members</div>\n                </div>\n                <div class=\"bg-gradient-to-r from-green-50 to-green-100 p-4 rounded-xl\">\n                    <div class=\"text-2xl font-bold text-green-600\" id=\"with-pictures\">-</div>\n                    <div class=\"text-sm text-green-700\">With Pictures</div>\n                </div>\n                <div class=\"bg-gradient-to-r from-red-50 to-red-100 p-4 rounded-xl\">\n                    <div class=\"text-2xl font-bold text-red-600\" id=\"without-pictures\">-</div>\n                    <div class=\"text-sm text-red-700\">Without Pictures</div>\n                </div>\n                <div class=\"bg-gradient-to-r from-purple-50 to-purple-100 p-4 rounded-xl\">\n                    <div class=\"text-2xl font-bold text-purple-600\" id=\"completion-rate\">-</div>\n                    <div class=\"text-sm text-purple-700\">Completion Rate</div>\n                </div>\n            </div>\n        </div>\n\n        <!-- Upload Methods -->\n        <div class=\"grid grid-cols-1 lg:grid-cols-2 gap-6\">\n            <!-- Single Upload Method -->\n            <div class=\"bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100\">\n                <div class=\"bg-gradient-to-r from-blue-600 to-purple-600 p-6 text-center\">\n                    <i class=\"fas fa-upload text-white text-3xl mb-3\"></i>\n                    <h3 class=\"text-xl font-bold text-white\">Individual Upload</h3>\n                    <p class=\"text-white/80 text-sm\">Upload pictures one by one with member selection</p>\n                </div>\n                \n                <div class=\"p-6\">\n                    <form id=\"single-upload-form\" class=\"space-y-4\">\n                        @csrf\n                        <div>\n                            <label class=\"block text-sm font-bold text-gray-700 mb-2\">\n                                <i class=\"fas fa-user mr-2 text-blue-600\"></i>Select Member\n                            </label>\n                            <select id=\"single-member-select\" class=\"w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:ring-2 focus:ring-blue-500 focus:border-blue-500 transition-all text-sm\">\n                                <option value=\"\">Choose a member...</option>\n                                @foreach($members as $member)\n                                    <option value=\"{{ $member->id }}\" data-has-picture=\"{{ $member->profile_picture ? 'true' : 'false' }}\">\n                                        {{ $member->full_name }} ({{ $member->member_id }})\n                                        @if($member->profile_picture) ✓ @else ✗ @endif\n                                    </option>\n                                @endforeach\n                            </select>\n                        </div>\n                        \n                        <div class=\"picture-drop-zone border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-blue-500 transition-all cursor-pointer\" onclick=\"document.getElementById('single-picture').click()\">\n                            <i class=\"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3\"></i>\n                            <p class=\"text-gray-600 font-medium\">Click to select or drag & drop image</p>\n                            <p class=\"text-gray-500 text-sm mt-1\">JPEG, PNG, GIF, WebP (Max: 5MB)</p>\n                            <input type=\"file\" id=\"single-picture\" accept=\"image/*\" class=\"hidden\">\n                        </div>\n                        \n                        <div id=\"single-preview\" class=\"hidden\">\n                            <div class=\"flex items-center gap-4 p-4 bg-gray-50 rounded-xl\">\n                                <img id=\"single-preview-img\" class=\"w-16 h-16 rounded-lg object-cover\">\n                                <div class=\"flex-1\">\n                                    <div class=\"font-medium text-gray-800\" id=\"single-file-name\"></div>\n                                    <div class=\"text-sm text-gray-600\" id=\"single-file-info\"></div>\n                                </div>\n                                <button type=\"button\" onclick=\"clearSinglePreview()\" class=\"text-red-500 hover:text-red-700\">\n                                    <i class=\"fas fa-times\"></i>\n                                </button>\n                            </div>\n                        </div>\n                        \n                        <button type=\"submit\" class=\"w-full px-6 py-3 bg-gradient-to-r from-blue-600 to-purple-600 text-white rounded-xl hover:shadow-lg transition-all font-bold\">\n                            <i class=\"fas fa-upload mr-2\"></i>Upload Picture\n                        </button>\n                    </form>\n                </div>\n            </div>\n\n            <!-- Bulk Upload Method -->\n            <div class=\"bg-white rounded-3xl shadow-2xl overflow-hidden border border-gray-100\">\n                <div class=\"bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-center\">\n                    <i class=\"fas fa-images text-white text-3xl mb-3\"></i>\n                    <h3 class=\"text-xl font-bold text-white\">Bulk Upload</h3>\n                    <p class=\"text-white/80 text-sm\">Upload multiple pictures and assign to members</p>\n                </div>\n                \n                <div class=\"p-6\">\n                    <form id=\"bulk-upload-form\" class=\"space-y-4\">\n                        @csrf\n                        <div class=\"picture-drop-zone border-2 border-dashed border-gray-300 rounded-xl p-8 text-center hover:border-purple-500 transition-all cursor-pointer\" onclick=\"document.getElementById('bulk-pictures').click()\">\n                            <i class=\"fas fa-cloud-upload-alt text-4xl text-gray-400 mb-3\"></i>\n                            <p class=\"text-gray-600 font-medium\">Click to select or drag & drop multiple images</p>\n                            <p class=\"text-gray-500 text-sm mt-1\">JPEG, PNG, GIF, WebP (Max: 20 files, 5MB each)</p>\n                            <input type=\"file\" id=\"bulk-pictures\" accept=\"image/*\" multiple class=\"hidden\">\n                        </div>\n                        \n                        <div id=\"bulk-preview\" class=\"hidden space-y-3\">\n                            <h4 class=\"font-bold text-gray-800\">Selected Images:</h4>\n                            <div id=\"bulk-preview-list\" class=\"space-y-2 max-h-60 overflow-y-auto\"></div>\n                        </div>\n                        \n                        <button type=\"submit\" class=\"w-full px-6 py-3 bg-gradient-to-r from-purple-600 to-pink-600 text-white rounded-xl hover:shadow-lg transition-all font-bold\">\n                            <i class=\"fas fa-images mr-2\"></i>Process Bulk Upload\n                        </button>\n                    </form>\n                </div>\n            </div>\n        </div>\n\n        <!-- Recent Uploads -->\n        <div class=\"bg-white rounded-3xl shadow-2xl p-6 border border-gray-100\">\n            <div class=\"flex items-center justify-between mb-6\">\n                <div class=\"flex items-center gap-3\">\n                    <div class=\"bg-gradient-to-r from-green-600 to-teal-600 p-3 rounded-xl shadow-lg\">\n                        <i class=\"fas fa-history text-white text-lg\"></i>\n                    </div>\n                    <h3 class=\"text-xl font-bold text-gray-800\">Recent Uploads</h3>\n                </div>\n                <button onclick=\"refreshRecentUploads()\" class=\"px-4 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg transition-all\">\n                    <i class=\"fas fa-refresh mr-2\"></i>Refresh\n                </button>\n            </div>\n            \n            <div id=\"recent-uploads\" class=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4\">\n                <!-- Recent uploads will be loaded here -->\n            </div>\n        </div>\n    </div>\n\n    <!-- Upload Progress Modal -->\n    <div id=\"upload-modal\" class=\"fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50\">\n        <div class=\"bg-white rounded-3xl p-8 max-w-md w-full mx-4\">\n            <div class=\"text-center\">\n                <div class=\"w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mx-auto mb-4\">\n                    <i class=\"fas fa-upload text-blue-600 text-2xl\"></i>\n                </div>\n                <h3 class=\"text-xl font-bold text-gray-800 mb-2\">Uploading Pictures</h3>\n                <p class=\"text-gray-600 mb-6\" id=\"upload-status\">Processing your upload...</p>\n                \n                <div class=\"w-full bg-gray-200 rounded-full h-3 mb-4\">\n                    <div id=\"upload-progress-bar\" class=\"bg-gradient-to-r from-blue-600 to-purple-600 h-3 rounded-full transition-all duration-300\" style=\"width: 0%\"></div>\n                </div>\n                \n                <div class=\"text-sm text-gray-500\" id=\"upload-details\">0 of 0 completed</div>\n            </div>\n        </div>\n    </div>\n</div>\n\n<script src=\"{{ asset('js/member-picture-manager.js') }}\"></script>\n<script>\nclass BulkPictureUploader {\n    constructor() {\n        this.init();\n        this.loadStatistics();\n        this.loadRecentUploads();\n    }\n\n    init() {\n        this.setupEventListeners();\n        this.setupDragAndDrop();\n    }\n\n    setupEventListeners() {\n        // Single upload form\n        document.getElementById('single-upload-form').addEventListener('submit', (e) => {\n            e.preventDefault();\n            this.handleSingleUpload();\n        });\n\n        // Bulk upload form\n        document.getElementById('bulk-upload-form').addEventListener('submit', (e) => {\n            e.preventDefault();\n            this.handleBulkUpload();\n        });\n\n        // File input changes\n        document.getElementById('single-picture').addEventListener('change', (e) => {\n            this.previewSingleFile(e.target.files[0]);\n        });\n\n        document.getElementById('bulk-pictures').addEventListener('change', (e) => {\n            this.previewBulkFiles(Array.from(e.target.files));\n        });\n    }\n\n    setupDragAndDrop() {\n        const dropZones = document.querySelectorAll('.picture-drop-zone');\n        \n        dropZones.forEach(zone => {\n            zone.addEventListener('dragover', (e) => {\n                e.preventDefault();\n                zone.classList.add('border-blue-500', 'bg-blue-50');\n            });\n\n            zone.addEventListener('dragleave', (e) => {\n                e.preventDefault();\n                zone.classList.remove('border-blue-500', 'bg-blue-50');\n            });\n\n            zone.addEventListener('drop', (e) => {\n                e.preventDefault();\n                zone.classList.remove('border-blue-500', 'bg-blue-50');\n                \n                const files = Array.from(e.dataTransfer.files).filter(f => f.type.startsWith('image/'));\n                \n                if (zone.closest('#single-upload-form')) {\n                    if (files.length > 0) this.previewSingleFile(files[0]);\n                } else {\n                    this.previewBulkFiles(files);\n                }\n            });\n        });\n    }\n\n    previewSingleFile(file) {\n        if (!file) return;\n        \n        const preview = document.getElementById('single-preview');\n        const img = document.getElementById('single-preview-img');\n        const name = document.getElementById('single-file-name');\n        const info = document.getElementById('single-file-info');\n        \n        const reader = new FileReader();\n        reader.onload = (e) => {\n            img.src = e.target.result;\n            name.textContent = file.name;\n            info.textContent = `${(file.size / 1024 / 1024).toFixed(2)} MB`;\n            preview.classList.remove('hidden');\n        };\n        reader.readAsDataURL(file);\n    }\n\n    previewBulkFiles(files) {\n        if (files.length === 0) return;\n        \n        const preview = document.getElementById('bulk-preview');\n        const list = document.getElementById('bulk-preview-list');\n        \n        list.innerHTML = '';\n        \n        files.forEach((file, index) => {\n            const item = document.createElement('div');\n            item.className = 'flex items-center gap-3 p-3 bg-gray-50 rounded-lg';\n            item.innerHTML = `\n                <img class=\"w-12 h-12 rounded-lg object-cover\" id=\"bulk-img-${index}\">\n                <div class=\"flex-1\">\n                    <div class=\"font-medium text-gray-800\">${file.name}</div>\n                    <div class=\"text-sm text-gray-600\">${(file.size / 1024 / 1024).toFixed(2)} MB</div>\n                </div>\n                <select class=\"px-3 py-1 border rounded-lg text-sm\" data-file-index=\"${index}\">\n                    <option value=\"\">Select member...</option>\n                    @foreach($members as $member)\n                        <option value=\"{{ $member->id }}\">{{ $member->full_name }}</option>\n                    @endforeach\n                </select>\n                <button type=\"button\" onclick=\"this.parentElement.remove()\" class=\"text-red-500 hover:text-red-700\">\n                    <i class=\"fas fa-times\"></i>\n                </button>\n            `;\n            \n            list.appendChild(item);\n            \n            // Load image preview\n            const reader = new FileReader();\n            reader.onload = (e) => {\n                document.getElementById(`bulk-img-${index}`).src = e.target.result;\n            };\n            reader.readAsDataURL(file);\n        });\n        \n        preview.classList.remove('hidden');\n    }\n\n    async handleSingleUpload() {\n        const memberId = document.getElementById('single-member-select').value;\n        const fileInput = document.getElementById('single-picture');\n        \n        if (!memberId || !fileInput.files[0]) {\n            alert('Please select a member and choose a picture');\n            return;\n        }\n\n        this.showUploadModal('Uploading picture...', 0, 1);\n        \n        try {\n            const formData = new FormData();\n            formData.append('profile_picture', fileInput.files[0]);\n            formData.append('_token', document.querySelector('meta[name=\"csrf-token\"]').content);\n\n            const response = await fetch(`/admin/members/${memberId}/picture/upload`, {\n                method: 'POST',\n                body: formData\n            });\n\n            const result = await response.json();\n            \n            if (result.success) {\n                this.showSuccess('Picture uploaded successfully!');\n                this.resetSingleForm();\n                this.loadStatistics();\n                this.loadRecentUploads();\n            } else {\n                this.showError(result.message || 'Upload failed');\n            }\n        } catch (error) {\n            this.showError('Upload failed: ' + error.message);\n        } finally {\n            this.hideUploadModal();\n        }\n    }\n\n    async handleBulkUpload() {\n        const fileSelects = document.querySelectorAll('#bulk-preview-list select');\n        const uploads = [];\n        \n        fileSelects.forEach((select, index) => {\n            if (select.value) {\n                uploads.push({\n                    memberId: select.value,\n                    fileIndex: index\n                });\n            }\n        });\n        \n        if (uploads.length === 0) {\n            alert('Please assign at least one picture to a member');\n            return;\n        }\n\n        this.showUploadModal('Processing bulk upload...', 0, uploads.length);\n        \n        let completed = 0;\n        const results = [];\n        \n        for (const upload of uploads) {\n            try {\n                const fileInput = document.getElementById('bulk-pictures');\n                const file = fileInput.files[upload.fileIndex];\n                \n                const formData = new FormData();\n                formData.append('profile_picture', file);\n                formData.append('_token', document.querySelector('meta[name=\"csrf-token\"]').content);\n\n                const response = await fetch(`/admin/members/${upload.memberId}/picture/upload`, {\n                    method: 'POST',\n                    body: formData\n                });\n\n                const result = await response.json();\n                results.push(result);\n                \n                completed++;\n                this.updateUploadProgress(completed, uploads.length);\n                \n            } catch (error) {\n                results.push({ success: false, error: error.message });\n                completed++;\n                this.updateUploadProgress(completed, uploads.length);\n            }\n        }\n        \n        const successful = results.filter(r => r.success).length;\n        const failed = results.length - successful;\n        \n        this.hideUploadModal();\n        \n        if (successful > 0) {\n            this.showSuccess(`Bulk upload completed! ${successful} successful, ${failed} failed.`);\n            this.resetBulkForm();\n            this.loadStatistics();\n            this.loadRecentUploads();\n        } else {\n            this.showError('All uploads failed. Please check your files and try again.');\n        }\n    }\n\n    async loadStatistics() {\n        try {\n            const response = await fetch('/api/members/pictures/statistics');\n            const result = await response.json();\n            \n            if (result.success) {\n                const data = result.data;\n                document.getElementById('total-members').textContent = data.total_members;\n                document.getElementById('with-pictures').textContent = data.members_with_pictures;\n                document.getElementById('without-pictures').textContent = data.members_without_pictures;\n                document.getElementById('completion-rate').textContent = data.completion_percentage + '%';\n            }\n        } catch (error) {\n            console.error('Failed to load statistics:', error);\n        }\n    }\n\n    async loadRecentUploads() {\n        // Implementation for loading recent uploads\n        const container = document.getElementById('recent-uploads');\n        container.innerHTML = '<div class=\"col-span-full text-center text-gray-500\">Loading recent uploads...</div>';\n        \n        // This would typically fetch from an API endpoint\n        setTimeout(() => {\n            container.innerHTML = '<div class=\"col-span-full text-center text-gray-500\">No recent uploads found</div>';\n        }, 1000);\n    }\n\n    showUploadModal(message, current, total) {\n        const modal = document.getElementById('upload-modal');\n        const status = document.getElementById('upload-status');\n        const details = document.getElementById('upload-details');\n        \n        status.textContent = message;\n        details.textContent = `${current} of ${total} completed`;\n        modal.classList.remove('hidden');\n        modal.classList.add('flex');\n    }\n\n    updateUploadProgress(current, total) {\n        const progressBar = document.getElementById('upload-progress-bar');\n        const details = document.getElementById('upload-details');\n        \n        const percentage = (current / total) * 100;\n        progressBar.style.width = percentage + '%';\n        details.textContent = `${current} of ${total} completed`;\n    }\n\n    hideUploadModal() {\n        const modal = document.getElementById('upload-modal');\n        modal.classList.add('hidden');\n        modal.classList.remove('flex');\n    }\n\n    resetSingleForm() {\n        document.getElementById('single-member-select').value = '';\n        document.getElementById('single-picture').value = '';\n        document.getElementById('single-preview').classList.add('hidden');\n    }\n\n    resetBulkForm() {\n        document.getElementById('bulk-pictures').value = '';\n        document.getElementById('bulk-preview').classList.add('hidden');\n        document.getElementById('bulk-preview-list').innerHTML = '';\n    }\n\n    showSuccess(message) {\n        this.showNotification(message, 'success');\n    }\n\n    showError(message) {\n        this.showNotification(message, 'error');\n    }\n\n    showNotification(message, type) {\n        // Use the notification system from member-picture-manager.js\n        if (window.memberPictureManager) {\n            if (type === 'success') {\n                window.memberPictureManager.showSuccess(message);\n            } else {\n                window.memberPictureManager.showError(message);\n            }\n        } else {\n            alert(message);\n        }\n    }\n}\n\n// Helper functions\nfunction clearSinglePreview() {\n    document.getElementById('single-picture').value = '';\n    document.getElementById('single-preview').classList.add('hidden');\n}\n\nfunction refreshRecentUploads() {\n    if (window.bulkUploader) {\n        window.bulkUploader.loadRecentUploads();\n    }\n}\n\n// Initialize when DOM is loaded\ndocument.addEventListener('DOMContentLoaded', () => {\n    window.bulkUploader = new BulkPictureUploader();\n});\n</script>\n@endsection